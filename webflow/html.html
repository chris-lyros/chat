<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raff - Your AI Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-bg: #1a1d2e;
            --secondary-bg: #252837;
            --accent-color: #10b981;
            --accent-hover: #059669;
            --text-primary: #e5e7eb;
            --text-secondary: #9ca3af;
            --border-color: #374151;
            --warning-bg: #7f1d1d;
            --warning-text: #fca5a5;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--primary-bg);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }

        /* Top Banner */
        .top-banner {
            background: var(--secondary-bg);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--accent-color), #3b82f6);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .banner-buttons {
            display: flex;
            gap: 0.75rem;
        }

        .banner-btn {
            padding: 0.5rem 1rem;
            background: var(--primary-bg);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .banner-btn:hover {
            background: var(--accent-color);
            border-color: var(--accent-color);
        }

        /* Main Container */
        .main-container {
            display: flex;
            height: calc(100vh - 73px);
            position: relative;
        }

        /* Chat Area */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
            overflow-y: auto;
            transition: margin-right 0.3s ease;
        }

        .chat-area.panel-open {
            margin-right: 400px;
        }

        .chat-content {
            max-width: 800px;
            width: 100%;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .welcome-section {
            text-align: center;
            margin: auto 0;
        }

        .welcome-section h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--accent-color), #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .welcome-section p {
            color: var(--text-secondary);
            font-size: 1.125rem;
        }

        /* Messages */
        .messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 1rem;
        }

        .message {
            margin-bottom: 1rem;
            padding: 1rem;
            background: var(--secondary-bg);
            border-radius: 8px;
        }

        .message.user {
            background: #1e3a5f;
        }

        /* Model Controls */
        .model-controls {
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.25rem;
            margin-bottom: 1rem;
        }

        .control-group {
            margin-bottom: 1rem;
        }

        .control-group:last-child {
            margin-bottom: 0;
        }

        .control-group label {
            display: block;
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        select, input[type="text"] {
            width: 100%;
            padding: 0.625rem;
            background: var(--primary-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        select:focus, input[type="text"]:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            cursor: help;
        }

        .checkbox-item[title]:hover::after {
            content: attr(title);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--secondary-bg);
            color: var(--text-primary);
            padding: 0.75rem;
            border-radius: 6px;
            font-size: 0.75rem;
            line-height: 1.4;
            width: 250px;
            margin-bottom: 0.5rem;
            z-index: 1000;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            white-space: normal;
            pointer-events: none;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--accent-color);
        }

        .checkbox-item label {
            font-size: 0.875rem;
            margin: 0;
            text-transform: none;
            letter-spacing: normal;
            cursor: pointer;
        }

        /* Creative Slider */
        .creative-slider {
            margin-top: 0.75rem;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        input[type="range"] {
            flex: 1;
            height: 4px;
            background: var(--border-color);
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
            transition: background 0.2s;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: var(--accent-color);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }

        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: var(--accent-color);
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }

        input[type="range"]::-moz-range-thumb:hover {
            transform: scale(1.1);
        }

        .slider-label {
            font-size: 0.875rem;
            color: var(--accent-color);
            min-width: 150px;
            text-align: right;
            font-weight: 500;
        }

        /* Input Area */
        .input-area {
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.75rem;
            display: flex;
            gap: 0.75rem;
        }

        .input-area input {
            border: none;
            padding: 0.5rem;
        }

        .send-btn {
            padding: 0.75rem 1.5rem;
            background: var(--accent-color);
            border: none;
            border-radius: 6px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .send-btn:hover {
            background: var(--accent-hover);
        }

        /* Side Panels */
        .side-panel {
            position: fixed;
            top: 73px;
            right: -400px;
            width: 400px;
            height: calc(100vh - 73px);
            background: var(--secondary-bg);
            border-left: 1px solid var(--border-color);
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
            z-index: 100;
        }

        .side-panel.open {
            right: 0;
        }

        .panel-header {
            padding: 1.25rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-header h2 {
            font-size: 1.25rem;
        }

        .close-panel {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
        }

        .close-panel:hover {
            background: var(--primary-bg);
            color: var(--text-primary);
        }

        .panel-content {
            flex: 1;
            padding: 1.25rem;
            overflow-y: auto;
        }

        .panel-info {
            background: var(--primary-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .panel-info h3 {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .panel-info .value {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--accent-color);
        }

        .panel-info .subtext {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .warning-box {
            background: var(--warning-bg);
            border: 1px solid var(--warning-text);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .warning-box h4 {
            color: var(--warning-text);
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        .warning-box p {
            color: var(--warning-text);
            font-size: 0.75rem;
            line-height: 1.5;
        }

        .memory-list {
            list-style: none;
        }

        .memory-item {
            background: var(--primary-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .memory-item h4 {
            font-size: 0.75rem;
            color: var(--accent-color);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .memory-item p {
            font-size: 0.875rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .panel-chat {
            border-top: 1px solid var(--border-color);
            padding: 1rem;
        }

        .panel-chat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .panel-input-area {
            display: flex;
            gap: 0.5rem;
        }

        .panel-input-area input {
            flex: 1;
            padding: 0.625rem;
            background: var(--primary-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .panel-input-area button {
            padding: 0.625rem 1rem;
            background: var(--accent-color);
            border: none;
            border-radius: 6px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.875rem;
        }

        .panel-input-area button:hover {
            background: var(--accent-hover);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .top-banner {
                padding: 1rem;
            }

            .chat-area {
                padding: 1rem;
            }

            .welcome-section h1 {
                font-size: 2rem;
            }

            .side-panel {
                width: 100%;
                right: -100%;
            }

            .chat-area.panel-open {
                margin-right: 0;
            }

            .banner-buttons {
                width: 100%;
                justify-content: flex-end;
            }
        }

        /* Cost indicator in dropdown */
        .model-strength {
            color: var(--text-secondary);
            font-size: 0.813rem;
            margin-top: 0.5rem;
            font-style: italic;
        }

        .model-strength::before {
            content: "‚ú® ";
        }
    </style>
</head>
<body>
    <!-- Top Banner -->
    <div class="top-banner">
        <div class="logo">
            <div class="logo-icon">ü§ñ</div>
            <span>Raff</span>
        </div>
        <div class="banner-buttons">
            <button class="banner-btn" onclick="togglePanel('about')"><span>‚ÑπÔ∏è</span> About</button>
            <button class="banner-btn" onclick="togglePanel('spend')"><span>üí∞</span> Spend</button>
            <button class="banner-btn" onclick="togglePanel('mems')"><span>üß†</span> Mems</button>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Chat Area -->
        <div class="chat-area" id="chatArea">
            <div class="chat-content">
                <!-- Welcome Section -->
                <div class="welcome-section" id="welcomeSection">
                    <h1>Welcome to Raff</h1>
                    <p>Your intelligent AI assistant with privacy and control</p>
                </div>

                <!-- Messages (hidden initially) -->
                <div class="messages" id="messages" style="display: none;"></div>

                <!-- Model Controls -->
                <div class="model-controls">
                    <div class="control-group">
                        <label>Model</label>
                        <select id="modelSelect" onchange="updateModelInfo()">
                            <option value="claude-opus-4" data-cost="15.00" data-strength="Deep reasoning" data-supplier="anthropic">Claude Opus 4 - $15.00 / 1M</option>
                            <option value="grok-2" data-cost="10.00" data-strength="Real-time insights" data-supplier="xai">Grok-2 - $10.00 / 1M</option>
                            <option value="gpt-4o" data-cost="5.00" data-strength="Vision & reasoning" data-supplier="openai">GPT-4o - $5.00 / 1M</option>
                            <option value="grok-beta" data-cost="5.00" data-strength="Experimental features" data-supplier="xai">Grok Beta - $5.00 / 1M</option>
                            <option value="claude-sonnet-4.5" data-cost="3.00" data-strength="Coding & reasoning" data-supplier="anthropic">Claude Sonnet 4.5 - $3.00 / 1M</option>
                            <option value="claude-sonnet-3.5" data-cost="3.00" data-strength="Writing & analysis" data-supplier="anthropic">Claude Sonnet 3.5 - $3.00 / 1M</option>
                            <option value="gpt-4-turbo" data-cost="3.00" data-strength="Complex tasks" data-supplier="openai">GPT-4 Turbo - $3.00 / 1M</option>
                            <option value="gemini-1.5-pro" data-cost="2.50" data-strength="Multimodal tasks" data-supplier="gemini">Gemini 1.5 Pro - $2.50 / 1M</option>
                            <option value="grok-2-mini" data-cost="2.00" data-strength="Real-time data" data-supplier="xai">Grok-2 Mini - $2.00 / 1M</option>
                            <option value="llama-3.1-405b" data-cost="0.80" data-strength="Advanced reasoning" data-supplier="meta">Llama 3.1 405B - $0.80 / 1M</option>
                            <option value="claude-haiku-4" data-cost="0.80" data-strength="Speed & cost" data-supplier="anthropic">Claude Haiku 4 - $0.80 / 1M</option>
                            <option value="gpt-4o-mini" data-cost="0.60" data-strength="Balanced performance" data-supplier="openai" selected>GPT-4o Mini - $0.60 / 1M</option>
                            <option value="llama-3.3-70b" data-cost="0.35" data-strength="Open-source power" data-supplier="meta">Llama 3.3 70B - $0.35 / 1M</option>
                            <option value="mistral-large" data-cost="0.30" data-strength="Reasoning & code" data-supplier="mistral">Mistral Large - $0.30 / 1M</option>
                            <option value="mixtral-8x7b" data-cost="0.24" data-strength="General tasks" data-supplier="mistral">Mixtral 8x7B - $0.24 / 1M</option>
                            <option value="gemini-1.5-flash" data-cost="0.15" data-strength="Fast responses" data-supplier="gemini">Gemini 1.5 Flash - $0.15 / 1M</option>
                            <option value="gemini-2.0-flash" data-cost="0.10" data-strength="Speed & efficiency" data-supplier="gemini">Gemini 2.0 Flash - $0.10 / 1M</option>
                        </select>
                        <div class="model-strength" id="modelStrength">Best for: Balanced performance</div>
                    </div>

                    <div class="control-group">
                        <label>Options</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item" title="Extended reasoning process - the model thinks through complex problems step-by-step before responding. Increases token usage but improves accuracy for difficult tasks.">
                                <input type="checkbox" id="thinkingEnabled" onchange="updateModelInfo()">
                                <label for="thinkingEnabled">ü§î Hmm</label>
                            </div>
                            <div class="checkbox-item" title="Real-time web search - the model searches the internet for current information and recent events. Adds context tokens but provides up-to-date answers.">
                                <input type="checkbox" id="webSearchEnabled" onchange="updateModelInfo()">
                                <label for="webSearchEnabled">üåê Web</label>
                            </div>
                            <div class="checkbox-item" title="Ignore your stored memory - the model responds without referencing your saved preferences, background, or past conversations. Useful for fresh perspectives.">
                                <input type="checkbox" id="ignoreMemory">
                                <label for="ignoreMemory">üö´ Mems</label>
                            </div>
                        </div>
                    </div>

                    <div class="control-group">
                        <label>Creativity</label>
                        <div class="creative-slider">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span style="font-size: 0.75rem; color: var(--text-secondary);">Less Creative</span>
                                <span style="font-size: 0.75rem; color: var(--text-secondary);">More Creative</span>
                            </div>
                            <div class="slider-container">
                                <input type="range" min="1" max="10" value="5" step="0.1" id="creativitySlider" oninput="updateCreativityLabel()">
                                <span class="slider-label" id="creativityLabel">Default (Balanced)</span>
                            </div>
                        </div>
                    </div>

                    <div class="control-group">
                        <label>Formality</label>
                        <div class="creative-slider">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span style="font-size: 0.75rem; color: var(--text-secondary);">Less Formal</span>
                                <span style="font-size: 0.75rem; color: var(--text-secondary);">More Formal</span>
                            </div>
                            <div class="slider-container">
                                <input type="range" min="1" max="10" value="5" step="0.1" id="formalitySlider" oninput="updateFormalityLabel()">
                                <span class="slider-label" id="formalityLabel">Normal Human</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Input Area -->
                <div class="input-area">
                    <input type="text" id="messageInput" placeholder="Send a message..." onkeypress="handleKeyPress(event)">
                    <button class="send-btn" onclick="sendMessage()">Send</button>
                </div>
                <div id="budgetWarning" style="text-align: center; margin-top: 0.5rem; font-size: 0.813rem; color: #f87171; display: none;">
                    ‚ö†Ô∏è Tracking to exceed budget - open Spend tab to update budget
                </div>
            </div>
        </div>

        <!-- About Panel -->
        <div class="side-panel" id="aboutPanel">
            <div class="panel-header">
                <h2>‚ÑπÔ∏è Why Raff?</h2>
                <button class="close-panel" onclick="closePanel('about')">√ó</button>
            </div>
            <div class="panel-content">
                <div class="panel-info" style="padding: 1.5rem;">
                    <div style="margin-bottom: 1.5rem;">
                        <h3 style="color: var(--accent-color); margin-bottom: 0.5rem; font-size: 1rem;">Full Cost Control</h3>
                        <p style="color: var(--text-secondary); font-size: 0.875rem; line-height: 1.6;">Choose from 20+ models. Pay only for what you use. Real-time budget tracking and model switching.</p>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <h3 style="color: var(--accent-color); margin-bottom: 0.5rem; font-size: 1rem;">Privacy First</h3>
                        <p style="color: var(--text-secondary); font-size: 0.875rem; line-height: 1.6;">Your chats stay in our database. Never used for training. PII automatically redacted before sending to LLMs.</p>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <h3 style="color: var(--accent-color); margin-bottom: 0.5rem; font-size: 1rem;">No Bias Creep</h3>
                        <p style="color: var(--text-secondary); font-size: 0.875rem; line-height: 1.6;">Memory stored separately from chat history. Get accurate, unbiased responses every time.</p>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <h3 style="color: var(--accent-color); margin-bottom: 0.5rem; font-size: 1rem;">Enterprise Ready</h3>
                        <p style="color: var(--text-secondary); font-size: 0.875rem; line-height: 1.6;">PII redaction protects sensitive business information. Safe for corporate use.</p>
                    </div>

                    <div style="border-top: 1px solid var(--border-color); padding-top: 1.5rem; margin-top: 1.5rem;">
                        <h3 style="color: var(--accent-color); margin-bottom: 1rem; font-size: 1rem;">Privacy Settings</h3>
                        <div class="checkbox-item" style="justify-content: flex-start;">
                            <input type="checkbox" id="piiRedactionEnabled" checked onchange="handlePIIToggle(this)">
                            <label for="piiRedactionEnabled" style="font-size: 0.875rem;">Enable PII Redaction (Recommended)</label>
                        </div>
                        <p style="color: var(--text-secondary); font-size: 0.75rem; line-height: 1.5; margin-top: 0.75rem;">
                            When enabled, names, emails, phone numbers, and sensitive business data are automatically redacted before sending to LLMs.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Spend Panel -->
        <div class="side-panel" id="spendPanel">
            <div class="panel-header">
                <h2>üí∞ Spending</h2>
                <button class="close-panel" onclick="closePanel('spend')">√ó</button>
            </div>
            <div class="panel-content">
                <div style="padding: 0.5rem;">
                    <div style="margin-bottom: 2rem;">
                        <h3 style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem;">Current Cycle (2 days)</h3>
                        <div style="font-size: 2rem; font-weight: 600; color: var(--accent-color); margin-bottom: 0.25rem;">$8.47</div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary);">28 days total in billing cycle</div>
                    </div>

                    <div style="margin-bottom: 2rem;">
                        <h3 style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem;">Projected Month-End</h3>
                        <div id="projectedAmount" style="font-size: 2rem; font-weight: 600; color: #f87171; margin-bottom: 0.25rem;">$118.58</div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.75rem;">Based on current usage rate</div>
                        <div id="budgetWarningSpend" style="color: #fca5a5; font-size: 0.875rem; line-height: 1.5;">
                            ‚ö†Ô∏è On track to exceed budget by $98.59.<br>
                            <button onclick="switchToRecommendedModel()" style="background: none; border: none; color: var(--accent-color); text-decoration: underline; cursor: pointer; padding: 0; margin-top: 0.5rem; font-size: 0.875rem;">Consider switching to <span id="recommendedModel">GPT-4o Mini</span></button>
                        </div>
                    </div>

                    <div style="margin-bottom: 2rem;">
                        <h3 style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem;">Monthly Budget Target</h3>
                        <div style="font-size: 2rem; font-weight: 600; color: var(--accent-color); margin-bottom: 0.5rem;">$19.99</div>
                        <input type="number" id="budgetInput" style="width: 100%; padding: 0.5rem; background: var(--primary-bg); border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-primary); font-size: 0.875rem;" 
                               value="19.99" onchange="updateBudget(this.value)">
                    </div>

                    <div>
                        <h3 style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 1rem;">This Session</h3>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="color: var(--text-secondary); font-size: 0.875rem;">Input tokens:</span>
                            <span style="color: var(--text-primary); font-size: 0.875rem;">1,240 ($0.001)</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="color: var(--text-secondary); font-size: 0.875rem;">Output tokens:</span>
                            <span style="color: var(--text-primary); font-size: 0.875rem;">890 ($0.001)</span>
                        </div>
                        <div style="border-top: 1px solid var(--border-color); margin-top: 0.75rem; padding-top: 0.75rem; display: flex; justify-content: space-between;">
                            <span style="color: var(--text-primary); font-size: 0.875rem; font-weight: 600;">Session Total:</span>
                            <span style="color: var(--accent-color); font-size: 0.875rem; font-weight: 600;">$0.002</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel-chat">
                <div class="panel-chat-label">Ask about costs & budgets</div>
                <div class="panel-input-area">
                    <input type="text" id="spendChatInput" placeholder="e.g., How can I save money?" onkeypress="handlePanelKeyPress(event, 'spend')">
                    <button onclick="sendPanelMessage('spend')">Send</button>
                </div>
            </div>
        </div>

        <!-- Mems Panel -->
        <div class="side-panel" id="memsPanel">
            <div class="panel-header">
                <h2>üß† Memory</h2>
                <button class="close-panel" onclick="closePanel('mems')">√ó</button>
            </div>
            <div class="panel-content">
                <div style="padding: 0.5rem;">
                    <p style="font-size: 0.875rem; color: var(--text-secondary); line-height: 1.6; margin-bottom: 1.5rem;">
                        Your memory helps Raff remember you across conversations without forming biased patterns. Memory is stored separately from chat history for accurate, context-aware responses.
                    </p>

                    <div style="background: var(--primary-bg); border: 1px solid var(--border-color); border-radius: 8px; padding: 1.25rem; line-height: 1.8; color: var(--text-secondary); font-size: 0.875rem;">
                        <span style="color: var(--accent-color); font-weight: 600;">Personal:</span> Lives in Melbourne, VIC. Enjoys specialty coffee and automation. Prefers direct communication style.
                        
                        <span style="display: block; margin-top: 1rem;"></span>
                        
                        <span style="color: var(--accent-color); font-weight: 600;">Professional:</span> CFO at Lyros Pty Ltd. Builds n8n workflows for business automation and customer applications. Focuses on cost-effective, maintainable solutions.
                        
                        <span style="display: block; margin-top: 1rem;"></span>
                        
                        <span style="color: var(--accent-color); font-weight: 600;">Writing Style:</span> Technical, concise, schema-first approach. Prefers bullet points and structured documentation.
                        
                        <span style="display: block; margin-top: 1rem;"></span>
                        
                        <span style="color: var(--accent-color); font-weight: 600;">Interests:</span> API integrations, workflow optimization, LLM applications, CrossFit, specialty coffee culture.
                    </div>
                </div>
            </div>
            <div class="panel-chat">
                <div class="panel-chat-label">Manage your memory</div>
                <div class="panel-input-area">
                    <input type="text" id="memsChatInput" placeholder="e.g., Update my coffee preference..." onkeypress="handlePanelKeyPress(event, 'mems')">
                    <button onclick="sendPanelMessage('mems')">Send</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State management
        let currentPanel = null;
        let hasRecommendedModel = false;
        let monthlyTokenUsage = { input: 142350, output: 89230 }; // Track total monthly usage
        let monthlyBudget = 19.99;
        
        const creativityLabels = {
            getRangeLabel: (value) => {
                if (value <= 1) return 'Robotic (Literal)';
                if (value <= 2) return 'Calculated (Precise)';
                if (value <= 3) return 'Measured (Conservative)';
                if (value <= 4) return 'Sensible (Grounded)';
                if (value <= 5) return 'Default (Balanced)';
                if (value <= 6) return 'Playful (Expressive)';
                if (value <= 7) return 'Adventurous (Bold)';
                if (value <= 8) return 'Wild (Experimental)';
                if (value <= 9) return 'Unhinged (Chaotic)';
                return 'Absolutely Feral (Maximum Chaos)';
            }
        };

        const formalityLabels = {
            getRangeLabel: (value) => {
                if (value <= 1) return 'Unhinged Gremlin';
                if (value <= 2) return 'Teenager Texting';
                if (value <= 3) return 'Meme Lord';
                if (value <= 4) return 'Text Message';
                if (value <= 5) return 'Normal Human';
                if (value <= 6) return 'Coffee Chat';
                if (value <= 7) return 'Business Email';
                if (value <= 8) return 'LinkedIn Professional';
                if (value <= 9) return 'Corporate Jargon';
                return 'Shakespearean Butler';
            }
        };

        // Model switching logic - Define BEFORE initialization
        const modelsBySupplier = {
            'gemini': [
                { value: 'gemini-2.0-flash', cost: 0.10, name: 'Gemini 2.0 Flash' },
                { value: 'gemini-1.5-flash', cost: 0.15, name: 'Gemini 1.5 Flash' },
                { value: 'gemini-1.5-pro', cost: 2.50, name: 'Gemini 1.5 Pro' }
            ],
            'openai': [
                { value: 'gpt-4o-mini', cost: 0.60, name: 'GPT-4o Mini' },
                { value: 'gpt-4-turbo', cost: 3.00, name: 'GPT-4 Turbo' },
                { value: 'gpt-4o', cost: 5.00, name: 'GPT-4o' }
            ],
            'anthropic': [
                { value: 'claude-haiku-4', cost: 0.80, name: 'Claude Haiku 4' },
                { value: 'claude-sonnet-3.5', cost: 3.00, name: 'Claude Sonnet 3.5' },
                { value: 'claude-sonnet-4.5', cost: 3.00, name: 'Claude Sonnet 4.5' },
                { value: 'claude-opus-4', cost: 15.00, name: 'Claude Opus 4' }
            ],
            'meta': [
                { value: 'llama-3.3-70b', cost: 0.35, name: 'Llama 3.3 70B' },
                { value: 'llama-3.1-405b', cost: 0.80, name: 'Llama 3.1 405B' }
            ],
            'mistral': [
                { value: 'mixtral-8x7b', cost: 0.24, name: 'Mixtral 8x7B' },
                { value: 'mistral-large', cost: 0.30, name: 'Mistral Large' }
            ],
            'xai': [
                { value: 'grok-2-mini', cost: 2.00, name: 'Grok-2 Mini' },
                { value: 'grok-beta', cost: 5.00, name: 'Grok Beta' },
                { value: 'grok-2', cost: 10.00, name: 'Grok-2' }
            ]
        };

        // Initialize
        updateCreativityLabel();
        updateFormalityLabel();
        updateModelInfo();
        updateRecommendedModel();
        checkBudgetWarning();

        // PII Toggle Handler
        function handlePIIToggle(checkbox) {
            if (!checkbox.checked) {
                const confirmed = confirm(
                    "‚ö†Ô∏è Warning: Disabling PII Redaction\n\n" +
                    "Without PII redaction, sensitive information like:\n" +
                    "‚Ä¢ Names and personal identifiers\n" +
                    "‚Ä¢ Email addresses and phone numbers\n" +
                    "‚Ä¢ Business-sensitive data\n\n" +
                    "...will be sent directly to third-party LLM providers.\n\n" +
                    "This may violate privacy policies or expose confidential information.\n\n" +
                    "Are you sure you want to disable PII redaction?"
                );
                
                if (!confirmed) {
                    checkbox.checked = true;
                }
            }
        }

        function updateRecommendedModel() {
            const select = document.getElementById('modelSelect');
            const currentOption = select.options[select.selectedIndex];
            const currentSupplier = currentOption.dataset.supplier;
            const currentCost = parseFloat(currentOption.dataset.cost);
            
            const warningElement = document.getElementById('budgetWarningSpend');
            
            // If we're at the cheapest model overall
            if (currentCost === 0.10) {
                if (warningElement && calculateMonthlyProjection() > monthlyBudget) {
                    warningElement.innerHTML = `<span style="color: #fca5a5; font-size: 0.875rem; line-height: 1.5;">
                        ‚ö†Ô∏è On track to exceed budget by $${(calculateMonthlyProjection() - monthlyBudget).toFixed(2)}.<br>
                        üí° Already using the cheapest model. Consider reducing usage or increasing your budget below.
                    </span>`;
                    warningElement.style.display = 'block';
                }
                return;
            }
            
            // If we already recommended and switched, don't recommend again
            if (hasRecommendedModel && calculateMonthlyProjection() <= monthlyBudget) {
                if (warningElement) {
                    warningElement.style.display = 'none';
                }
                return;
            }
            
            // Find next cheaper model from same supplier
            const supplierModels = modelsBySupplier[currentSupplier];
            let recommended = null;
            
            for (let model of supplierModels) {
                if (model.cost < currentCost) {
                    recommended = model;
                    break;
                }
            }
            
            // If no cheaper model from same supplier, recommend cheapest overall
            if (!recommended) {
                recommended = { name: 'Gemini 2.0 Flash', value: 'gemini-2.0-flash' };
            }
            
            const recommendedSpan = document.getElementById('recommendedModel');
            if (recommendedSpan) {
                recommendedSpan.textContent = recommended.name;
                recommendedSpan.dataset.value = recommended.value;
            }
            
            // Show or hide warning based on budget
            if (warningElement && calculateMonthlyProjection() > monthlyBudget) {
                warningElement.innerHTML = `<span style="color: #fca5a5; font-size: 0.875rem; line-height: 1.5;">
                    ‚ö†Ô∏è On track to exceed budget by $${(calculateMonthlyProjection() - monthlyBudget).toFixed(2)}.<br>
                    <button onclick="switchToRecommendedModel()" style="background: none; border: none; color: var(--accent-color); text-decoration: underline; cursor: pointer; padding: 0; margin-top: 0.5rem; font-size: 0.875rem;">Consider switching to <span id="recommendedModel">${recommended.name}</span></button>
                </span>`;
                warningElement.style.display = 'block';
            } else if (warningElement) {
                warningElement.style.display = 'none';
            }
        }

        function switchToRecommendedModel() {
            const recommendedSpan = document.getElementById('recommendedModel');
            const recommendedValue = recommendedSpan.dataset.value;
            
            const select = document.getElementById('modelSelect');
            const currentOption = select.options[select.selectedIndex];
            const currentCost = parseFloat(currentOption.dataset.cost);
            
            // Check if we're already at the cheapest model
            if (currentCost === 0.10) {
                alert('üí° You\'re already using the most cost-effective model (Gemini 2.0 Flash).\n\nTo reduce spending:\n‚Ä¢ Reduce usage frequency\n‚Ä¢ Disable "Hmm" (thinking) mode when not needed\n‚Ä¢ Increase your monthly budget in the field below');
                return;
            }
            
            select.value = recommendedValue;
            hasRecommendedModel = true;
            
            updateModelInfo();
            updateRecommendedModel();
            
            // Update warning display
            const warningElement = document.getElementById('budgetWarningSpend');
            const projectedSpend = calculateMonthlyProjection();
            
            if (projectedSpend <= monthlyBudget) {
                if (warningElement) {
                    warningElement.innerHTML = `<span style="color: var(--accent-color);">‚úÖ On track! Projected spend now within budget.</span>`;
                    setTimeout(() => {
                        warningElement.style.display = 'none';
                    }, 3000);
                }
                alert(`‚úÖ Switched to ${recommendedSpan.textContent}! You're now on track to stay within budget.`);
            } else {
                alert(`‚úÖ Switched to ${recommendedSpan.textContent}! This will help reduce your spending.`);
            }
        }

        // Panel management
        function togglePanel(panelName) {
            const panel = document.getElementById(panelName + 'Panel');
            const chatArea = document.getElementById('chatArea');
            
            if (currentPanel === panelName) {
                closePanel(panelName);
            } else {
                // Close other panel if open
                if (currentPanel) {
                    closePanel(currentPanel);
                }
                
                panel.classList.add('open');
                if (window.innerWidth > 768) {
                    chatArea.classList.add('panel-open');
                }
                currentPanel = panelName;
            }
        }

        function closePanel(panelName) {
            const panel = document.getElementById(panelName + 'Panel');
            const chatArea = document.getElementById('chatArea');
            
            panel.classList.remove('open');
            chatArea.classList.remove('panel-open');
            currentPanel = null;
        }

        // Creativity slider
        function updateCreativityLabel() {
            const slider = document.getElementById('creativitySlider');
            const label = document.getElementById('creativityLabel');
            const value = parseFloat(slider.value);
            label.textContent = creativityLabels.getRangeLabel(value);
        }

        // Formality slider
        function updateFormalityLabel() {
            const slider = document.getElementById('formalitySlider');
            const label = document.getElementById('formalityLabel');
            const value = parseFloat(slider.value);
            label.textContent = formalityLabels.getRangeLabel(value);
        }

        // Budget warning checker
        function checkBudgetWarning() {
            const warning = document.getElementById('budgetWarning');
            const currentSpend = calculateMonthlyProjection();
            
            if (currentSpend > monthlyBudget) {
                warning.style.display = 'block';
            } else {
                warning.style.display = 'none';
            }
        }

        // Calculate monthly projection based on current model
        function calculateMonthlyProjection() {
            const select = document.getElementById('modelSelect');
            const selectedOption = select.options[select.selectedIndex];
            const costPer1M = parseFloat(selectedOption.dataset.cost);
            
            const totalTokens = monthlyTokenUsage.input + monthlyTokenUsage.output;
            const costPerToken = costPer1M / 1000000;
            const monthlySpend = totalTokens * costPerToken;
            
            // Project for full month (28 days) based on 2 days usage
            return (monthlySpend / 2) * 28;
        }

        // Model info updater
        function updateModelInfo() {
            const select = document.getElementById('modelSelect');
            const selectedOption = select.options[select.selectedIndex];
            const strength = selectedOption.dataset.strength;
            
            const indicator = document.getElementById('modelStrength');
            indicator.textContent = `Best for: ${strength}`;
            
            // Update recommended model when current model changes
            updateRecommendedModel();
            
            // Update projected spending
            updateProjectedSpending();
            
            // Check budget warning
            checkBudgetWarning();
        }

        // Update projected spending display
        function updateProjectedSpending() {
            const projectedSpend = calculateMonthlyProjection();
            const projectedElement = document.getElementById('projectedAmount');
            const warningElement = document.getElementById('budgetWarningSpend');
            
            if (projectedElement) {
                if (projectedSpend <= monthlyBudget) {
                    projectedElement.style.color = 'var(--accent-color)';
                    projectedElement.textContent = `$${projectedSpend.toFixed(2)}`;
                    
                    // Hide warning if under budget
                    if (warningElement) {
                        warningElement.style.display = 'none';
                    }
                } else {
                    projectedElement.style.color = '#f87171';
                    projectedElement.textContent = `$${projectedSpend.toFixed(2)}`;
                    
                    // Show warning if over budget and haven't recommended yet
                    if (warningElement && !hasRecommendedModel) {
                        warningElement.style.display = 'block';
                    }
                }
            }
        }

        // Apply color coding to model options
        function applyModelColors() {
            const select = document.getElementById('modelSelect');
            const options = select.getElementsByTagName('option');
            
            for (let option of options) {
                const supplier = option.dataset.supplier;
                option.classList.add(`model-${supplier}`);
            }
        }

        // Message handling
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Hide welcome, show messages
            document.getElementById('welcomeSection').style.display = 'none';
            document.getElementById('messages').style.display = 'block';
            
            // Add user message
            addMessage(message, 'user');
            
            // Clear input
            input.value = '';
            
            // Simulate AI response
            setTimeout(() => {
                const model = document.getElementById('modelSelect').value;
                const creativityValue = parseFloat(document.getElementById('creativitySlider').value).toFixed(1);
                const creativityLabel = creativityLabels.getRangeLabel(parseFloat(creativityValue));
                const formalityValue = parseFloat(document.getElementById('formalitySlider').value).toFixed(1);
                const formalityLabel = formalityLabels.getRangeLabel(parseFloat(formalityValue));
                const ignoreMemory = document.getElementById('ignoreMemory').checked;
                
                let response = `I'm responding using ${model} with ${creativityLabel} creativity (${creativityValue}/10) and ${formalityLabel} formality (${formalityValue}/10).`;
                
                if (ignoreMemory) {
                    response += ' (Memory ignored for this response)';
                }
                
                addMessage(response, 'assistant');
            }, 1000);
        }

        function addMessage(text, role) {
            const messages = document.getElementById('messages');
            const message = document.createElement('div');
            message.className = `message ${role}`;
            message.textContent = text;
            messages.appendChild(message);
            messages.scrollTop = messages.scrollHeight;
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Panel chat handling
        function sendPanelMessage(panelType) {
            const input = document.getElementById(panelType + 'ChatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Simulate response (using cheapest model - Gemini 2.0 Flash)
            setTimeout(() => {
                if (panelType === 'spend') {
                    alert('Spend assistant (Gemini 2.0 Flash): ' + getSpendResponse(message));
                } else {
                    alert('Memory assistant (Gemini 2.0 Flash): ' + getMemoryResponse(message));
                }
            }, 500);
            
            input.value = '';
        }

        function handlePanelKeyPress(event, panelType) {
            if (event.key === 'Enter') {
                sendPanelMessage(panelType);
            }
        }

        function getSpendResponse(message) {
            if (message.toLowerCase().includes('save')) {
                return "To save money, consider switching to budget-tier models like Gemini 2.0 Flash ($0.10/1M) or Mixtral 8x7B ($0.24/1M). Disable 'Thinking' mode when not needed as it roughly doubles token usage.";
            }
            return "I can help you understand your spending, optimize model selection, and manage your budget. What would you like to know?";
        }

        function getMemoryResponse(message) {
            if (message.toLowerCase().includes('update') || message.toLowerCase().includes('change')) {
                return "I'll update your memory with that information. Memory changes take effect immediately and apply to all future conversations.";
            }
            return "I can help you view, update, or delete memory entries. Your memory helps me provide personalized responses while keeping chat history separate to avoid bias.";
        }

        function updateBudget(value) {
            monthlyBudget = parseFloat(value);
            hasRecommendedModel = false; // Reset recommendation flag when budget changes
            updateModelInfo(); // Recalculate everything
            console.log('Budget updated to: $' + value);
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            const chatArea = document.getElementById('chatArea');
            if (window.innerWidth <= 768) {
                chatArea.classList.remove('panel-open');
            } else if (currentPanel) {
                chatArea.classList.add('panel-open');
            }
        });
    </script>
</body>
</html>
